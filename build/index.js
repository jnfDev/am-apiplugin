(()=>{"use strict";const e=window.wp.element,t=window.wp.blocks,n=window.wp.blockEditor,l=window.wp.components,r=t=>{let{columns:n=[],setHiddenColumns:r,hiddenColumns:a=[]}=t;return(0,e.createElement)("div",{className:"columns-visibility"},n.map(((t,n)=>{const s=a.includes(`column_${n}`);return(0,e.createElement)(l.ToggleControl,{label:`Hide ${t}`,help:s?"Hidden":"Visible",checked:s,onChange:e=>{r(e?a.concat([`column_${n}`]):a.filter((e=>e!==`column_${n}`)))}})})))},a=t=>{let{data:n,hiddenColumns:l=[]}=t;const{title:r,data:a}=n;return(0,e.createElement)("div",{className:"Table"},(0,e.createElement)("h4",null,r),(0,e.createElement)("table",null,(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,a.headers.filter(((e,t)=>!l.includes(`column_${t}`))).map((t=>(0,e.createElement)("th",null,t))))),(0,e.createElement)("tbody",null,Object.values(a.rows).map((t=>(0,e.createElement)("tr",null,Object.values(t).filter(((e,t)=>!l.includes(`column_${t}`))).map((t=>(0,e.createElement)("td",null,t)))))))))},s=()=>(0,e.createElement)("div",{className:"Error"},"Error"),c=()=>(0,e.createElement)("div",{className:"Loading"},"Loading"),o=t=>{let{attributes:l,setAttributes:o}=t;const{adminVars:d,error:i,data:m,hiddenColumns:u}=l;return m||jQuery.post(d.url,{action:d.action,wpnonce:d.nonce},(e=>{let{data:t,success:n}=e;if(!n)return o({error:t.errorMessage});o({data:t})})),(0,e.createElement)(e.Fragment,null,i?(0,e.createElement)(s,{error:i}):m?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.InspectorControls,{key:"setting"},(0,e.createElement)(r,{columns:null==m||null===(E=m.data)||void 0===E?void 0:E.headers,hiddenColumns:u,setHiddenColumns:e=>{o({hiddenColumns:e})}})),(0,e.createElement)(a,{data:m,hiddenColumns:u})):(0,e.createElement)(c,null));var E};(0,t.registerBlockType)("am-apiplugin/am-apiblock",{edit:t=>{let{attributes:l,setAttributes:r}=t;return(0,e.createElement)("div",(0,n.useBlockProps)(),(0,e.createElement)(o,{attributes:l,setAttributes:r}))},save:t=>{let{attributes:l}=t;const{data:r,hiddenColumns:s}=l;return(0,e.createElement)("div",n.useBlockProps.save(),(0,e.createElement)(a,{data:r,hiddenColumns:s}))}})})();